dat_meta <- dat_meta %>% arrange(Pathogen, Profile)
# meta & forestplot -- Salmonella_typhi
ma.data <- metamean(n = n,
mean = Mean,
data = dat_meta,
sd = SD,
median = Median,
q1 = lower_i,
q3 = higher_i,
min = lower_r,
max = higher_r,
subgroup = resistance,
random = TRUE,
fixed = FALSE,
overall = FALSE)
png(file = paste(file_name), width = width_input, height = height_input, res = 300)
if(subgroup_input == "TRUE"){
forest(ma.data,
leftcols = c("Study", "Pathogen", "Profile", "Country"),
rightlabs = c("Mean", "95% CI"),
subgroup = TRUE,
xlim = c(xlim_low, xlim_high),
print.byvar = TRUE)}
else{
forest(ma.data,
leftcols = c("Study", "Pathogen", "Profile", "Country"),
rightlabs = c("Mean", "95% CI"),
subgroup = FALSE,
xlim = c(xlim_low, xlim_high),
print.byvar = TRUE)}
dev.off()
return(ma.data)}
# length of hospital stay;
los_typhi <- forest_plot(dat            = dat_stu_hos_typhi,
subgroup_input = "TRUE",
width_input    = 3200,
height_input   = 1800,
xlim_low       = 1,
xlim_high      = 15,
file_name      = "length_of_hospital_stay_typhi.png")
los_nontyphi <- forest_plot(dat            = dat_stu_hos_nontyphi,
subgroup_input = "TRUE",
width_input    = 3200,
height_input   = 1800,
xlim_low       = 1,
xlim_high      = 15,
file_name      = "length_of_hospital_stay_nontyphi.png")
loi_typhi <- forest_plot(dat            = dat_stu_fev,
subgroup_input = "TRUE",
width_input    = 3200,
height_input   = 1200,
xlim_low       = 1,
xlim_high      = 30,
file_name      = "length_of_illness.png")
setwd("~/GitHub/amr_cost")
# load libraries
library(googlesheets4)
library(data.table)
library(ggplot2)
library(tidyr)
library(gcookbook)
library(rworldmap)
library(dplyr)
library(meta)
library(metafor)
library(tidyverse)
# remove all objects from workspace
rm (list = ls ())
setwd("~/GitHub/amr_cost")
# start time
start_time <- Sys.time ()
print (paste0 ("start time = ", start_time))
# -----------------------------------------------------------------------------
### Importing data from Google Sheets
dat <- read_sheet('https://docs.google.com/spreadsheets/d/16I5yak3-j3rEqLLcdFCcqzeQSyYjSGihXIbmZxqEILs/edit#gid=2036014622')
### Study data
dat_study <- dat[, c("Study", "Pathogen", "Susceptible_profile", "Resistance_profile", "Country")]
dat_study$Pathogen <- factor(dat_study$Pathogen,
levels = c("S. Typhi",
"S. Typhi and S. Paratyphi",
"S. non-Typhi"))
# unique(dat_study$Resistance_profile)
dat_study$Resistance_profile <- factor(dat_study$Resistance_profile,
levels = c("Amikacin res.",
"Ampicillin res.",
"Ciprofloxacin res.",
"Nalidixic acid res.",
"res.",
"Tetracycline res.",
"MDR",
"XDR"))
dat_study$Susceptible_profile <- factor(dat_study$Susceptible_profile,
levels = sort(unique(dat_study$Susceptible_profile)))
# Hospitalization day data -- resistance
dat_los_res <- dat[, 59:67]
dat_stu_hos_res <- cbind(dat_study, dat_los_res)
dat_stu_hos_res <- dat_stu_hos_res[dat_stu_hos_res$Resistance_profile != "Mixed" &
dat_stu_hos_res$Resistance_profile != "Susceptible" &
dat_stu_hos_res$`How many days did the hospitalisation last?_resistant` != "NULL", ]
# Hospitalization day data -- susceptible
dat_los_sus <- dat[, 50:58]
dat_stu_hos_sus <- cbind(dat_study, dat_los_sus)
dat_stu_hos_sus <- dat_stu_hos_sus[((dat_stu_hos_sus$Susceptible_profile != "Mixed") &
!is.na(dat_stu_hos_sus$Susceptible_profile) &
(dat_stu_hos_sus$`How many days did the hospitalisation last?_susceptible` != "NULL")), ]
# Hospitalization day data -- S. typhi & S. paratyphi / S. non-typhi
dat_stu_hos_res_r <- data.table(dat_stu_hos_res)
dat_stu_hos_sus_s <- data.table(dat_stu_hos_sus)
dat_stu_hos_res_r <- dat_stu_hos_res_r %>% rename("days" = "How many days did the hospitalisation last?_resistant")
dat_stu_hos_sus_s <- dat_stu_hos_sus_s %>% rename("days" = "How many days did the hospitalisation last?_susceptible")
dat_stu_hos_res_r[, resistance := "resistance"]
dat_stu_hos_sus_s[, resistance := "susceptible"]
dat_stu_hos <- rbind(dat_stu_hos_res_r, dat_stu_hos_sus_s, use.names=FALSE)
dat_stu_hos[resistance == "resistance", Profile := Resistance_profile]
dat_stu_hos[resistance == "susceptible", Profile := Susceptible_profile]
dat_stu_hos_typhi<- dat_stu_hos[Pathogen == "S. Typhi" | Pathogen == "S. Typhi and S. Paratyphi",]
dat_stu_hos_nontyphi <- dat_stu_hos[Pathogen == "S. non-Typhi",]
# Duration of fever -- resistance
dat_fev_res <- dat[, 41:49]
dat_stu_fev_res <- cbind(dat_study, dat_fev_res)
dat_stu_fev_res <- dat_stu_fev_res[((dat_stu_fev_res$Resistance_profile != "Mixed") &
!is.na(dat_stu_fev_res$Resistance_profile) &
(dat_stu_fev_res$`How many days did the symptoms last?_resistant` != "NULL")), ]
# Duration of fever -- susceptible
dat_fev_sus <- dat[, 32:40]
dat_stu_fev_sus <- cbind(dat_study, dat_fev_sus)
dat_stu_fev_sus <- dat_stu_fev_sus[((dat_stu_fev_sus$Susceptible_profile != "Mixed") &
!is.na(dat_stu_fev_sus$Susceptible_profile) &
(dat_stu_fev_sus$`How many days did the symptoms last?_susceptible` != "NULL")), ]
# Fever day data -- S. typhi & S. paratyphi / S. non-typhi
dat_stu_fev_res_r <- data.table(dat_stu_fev_res)
dat_stu_fev_sus_s <- data.table(dat_stu_fev_sus)
dat_stu_fev_res_r <- dat_stu_fev_res_r %>% rename("days" = "How many days did the symptoms last?_resistant")
dat_stu_fev_sus_s <- dat_stu_fev_sus_s %>% rename("days" = "How many days did the symptoms last?_susceptible")
dat_stu_fev_res_r[, resistance := "resistance"]
dat_stu_fev_sus_s[, resistance := "susceptible"]
dat_stu_fev <- rbind(dat_stu_fev_res_r, dat_stu_fev_sus_s, use.names=FALSE)
dat_stu_fev[resistance == "resistance", Profile := Resistance_profile]
dat_stu_fev[resistance == "susceptible", Profile := Susceptible_profile]
# dat_stu_fev_typhi<- dat_stu_fev[Pathogen == "S. Typhi" | Pathogen == "S. Typhi and S. Paratyphi",]
# dat_stu_fev_nontyphi <- dat_stu_fev[Pathogen == "S. non-Typhi",]
dat_stu_fev <- dat_stu_fev[`What statistical measure was used to report the length of a symptomatic infection?_comment...43` !=
"The duration of illness between fever onset and hospitalization",]
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[dat_stu_cost_res$`What cost was measured?` == "Medical costs"|
dat_stu_cost_res$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_res$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_res$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_stu_cost_res <- dat_stu_cost_res[,-c(6:7)]
View(dat_cost_res)
View(dat_cost_res)
# Hospitalization day data -- resistance
dat_los_res <- dat[, 59:67]
dat_stu_hos_res <- cbind(dat_study, dat_los_res)
dat_stu_hos_res <- dat_stu_hos_res[dat_stu_hos_res$Resistance_profile != "Mixed" &
dat_stu_hos_res$Resistance_profile != "Susceptible" &
dat_stu_hos_res$`How many days did the hospitalisation last?_resistant` != "NULL", ]
# Hospitalization day data -- susceptible
dat_los_sus <- dat[, 50:58]
dat_stu_hos_sus <- cbind(dat_study, dat_los_sus)
dat_stu_hos_sus <- dat_stu_hos_sus[((dat_stu_hos_sus$Susceptible_profile != "Mixed") &
!is.na(dat_stu_hos_sus$Susceptible_profile) &
(dat_stu_hos_sus$`How many days did the hospitalisation last?_susceptible` != "NULL")), ]
dat_stu_hos_res_r <- data.table(dat_stu_hos_res)
dat_stu_hos_sus_s <- data.table(dat_stu_hos_sus)
dat_stu_hos_res_r <- dat_stu_hos_res_r %>% rename("days" = "How many days did the hospitalisation last?_resistant")
dat_stu_hos_sus_s <- dat_stu_hos_sus_s %>% rename("days" = "How many days did the hospitalisation last?_susceptible")
dat_stu_hos_res_r[, resistance := "resistance"]
dat_stu_hos_sus_s[, resistance := "susceptible"]
dat_stu_hos <- rbind(dat_stu_hos_res_r, dat_stu_hos_sus_s, use.names=FALSE)
dat_stu_hos[resistance == "resistance", Profile := Resistance_profile]
dat_stu_hos[resistance == "susceptible", Profile := Susceptible_profile]
dat_stu_hos_typhi<- dat_stu_hos[Pathogen == "S. Typhi" | Pathogen == "S. Typhi and S. Paratyphi",]
dat_stu_hos_nontyphi <- dat_stu_hos[Pathogen == "S. non-Typhi",]
dat_fev_res <- dat[, 41:49]
dat_stu_fev_res <- cbind(dat_study, dat_fev_res)
dat_stu_fev_res <- dat_stu_fev_res[((dat_stu_fev_res$Resistance_profile != "Mixed") &
!is.na(dat_stu_fev_res$Resistance_profile) &
(dat_stu_fev_res$`How many days did the symptoms last?_resistant` != "NULL")), ]
# Duration of fever -- susceptible
dat_fev_sus <- dat[, 32:40]
dat_stu_fev_sus <- cbind(dat_study, dat_fev_sus)
dat_stu_fev_sus <- dat_stu_fev_sus[((dat_stu_fev_sus$Susceptible_profile != "Mixed") &
!is.na(dat_stu_fev_sus$Susceptible_profile) &
(dat_stu_fev_sus$`How many days did the symptoms last?_susceptible` != "NULL")), ]
# Fever day data -- S. typhi & S. paratyphi / S. non-typhi
dat_stu_fev_res_r <- data.table(dat_stu_fev_res)
dat_stu_fev_sus_s <- data.table(dat_stu_fev_sus)
dat_stu_fev_res_r <- dat_stu_fev_res_r %>% rename("days" = "How many days did the symptoms last?_resistant")
dat_stu_fev_sus_s <- dat_stu_fev_sus_s %>% rename("days" = "How many days did the symptoms last?_susceptible")
dat_stu_fev_res_r[, resistance := "resistance"]
dat_stu_fev_sus_s[, resistance := "susceptible"]
dat_stu_fev <- rbind(dat_stu_fev_res_r, dat_stu_fev_sus_s, use.names=FALSE)
dat_stu_fev[resistance == "resistance", Profile := Resistance_profile]
dat_stu_fev[resistance == "susceptible", Profile := Susceptible_profile]
# dat_stu_fev_typhi<- dat_stu_fev[Pathogen == "S. Typhi" | Pathogen == "S. Typhi and S. Paratyphi",]
# dat_stu_fev_nontyphi <- dat_stu_fev[Pathogen == "S. non-Typhi",]
dat_stu_fev <- dat_stu_fev[`What statistical measure was used to report the length of a symptomatic infection?_comment...43` !=
"The duration of illness between fever onset and hospitalization",]
dat_cost_res <- dat[, c(68:69, 70:78)]
View(dat_cost_res)
# Cost -- resistance
dat_cost_res <- dat[, c(70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[dat_stu_cost_res$`What cost was measured?` == "Medical costs"|
dat_stu_cost_res$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_res$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_res$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[dat_stu_cost_res$`What cost was measured?` == "Medical costs"|
dat_stu_cost_res$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_res$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_res$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_stu_cost_res <- dat_stu_cost_res[,-c(6:7)]
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[dat_stu_cost_res$`What cost was measured?` == "Medical costs"|
dat_stu_cost_res$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_res$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_res$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_stu_cost_res <- dat_stu_cost_res[,-c(6:7)]
View(dat_stu_cost_res)
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[dat_stu_cost_res$`What cost was measured?` == "Medical costs"|
dat_stu_cost_res$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_res$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_res$`What cost was measured?` == "Inpatient treatment costs",]
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
View(dat_stu_cost_res)
View(dat_cost_res)
View(dat_stu_fev)
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[dat_stu_cost_res$`What cost was measured?` == "Medical costs"|
dat_stu_cost_res$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_res$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_res$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_cost_res <- dat[, c(70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[dat_stu_cost_res$`What cost was measured?` == "Medical costs"|
dat_stu_cost_res$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_res$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_res$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
View(dat_stu_cost_res)
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[dat_stu_cost_res$`What cost was measured?` == "Medical costs"|
dat_stu_cost_res$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_res$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_res$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_stu_cost_res <- dat_stu_cost_res[,-c(6:7)]
View(dat_stu_cost_res)
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
View(dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
View(dat_stu_cost_res)
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
# Cost -- resistance
dat_cost_res <- dat[, c(70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
# Cost -- resistance
dat_cost_res <- dat[, c(70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
# Cost -- resistance
dat_cost_res <- dat[, c(70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
# Cost -- resistance
dat_cost_res <- dat[, c(70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
View(dat_stu_cost_res)
68:69,
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_stu_cost_res <- dat_stu_cost_res[,-c(6:7)]
View(dat_stu_cost_res)
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
View(dat_stu_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_stu_cost_res <- dat_stu_cost_res[,-c(6:7)]
View(dat_stu_cost_res)
# Cost -- susceptible
dat_cost_sus <- dat[, c(68:69, 79:87)]
dat_stu_cost_sus <- cbind(dat_study, dat_cost_sus)
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$`What cost was measured?`),]
dat_stu_cost_sus <- dat_stu_cost_sus[is.na(dat_stu_cost_sus$Resistance_profile),]
dat_stu_cost_sus <- dat_stu_cost_sus[,-c(6:7)]
# Cost -- susceptible
dat_cost_sus <- dat[, c(68:69, 79:87)]
dat_stu_cost_sus <- cbind(dat_study, dat_cost_sus)
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$`What cost was measured?`),]
dat_stu_cost_sus <- dat_stu_cost_sus[is.na(dat_stu_cost_sus$Resistance_profile),]
dat_stu_cost_sus <- dat_stu_cost_sus[,-c(6:7)]
View(dat_stu_cost_sus)
# Cost -- susceptible
dat_cost_sus <- dat[, c(68:69, 79:87)]
dat_stu_cost_sus <- cbind(dat_study, dat_cost_sus)
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$`What cost was measured?`),]
dat_stu_cost_sus <- dat_stu_cost_sus[is.na(dat_stu_cost_sus$Resistance_profile),]
dat_stu_cost_sus <- dat_stu_cost_sus[,-c(6:7)]
# Cost -- susceptible
dat_cost_sus <- dat[, c(68:69, 79:87)]
dat_stu_cost_sus <- cbind(dat_study, dat_cost_sus)
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$`What cost was measured?`),]
dat_stu_cost_sus <- dat_stu_cost_sus[is.na(dat_stu_cost_sus$Resistance_profile),]
View(dat_stu_cost_sus)
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$Susceptible_profile),]
# Cost -- susceptible
dat_cost_sus <- dat[, c(68:69, 79:87)]
dat_stu_cost_sus <- cbind(dat_study, dat_cost_sus)
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$`What cost was measured?`),]
dat_stu_cost_sus <- dat_stu_cost_sus[dat_stu_cost_sus$`What cost was measured?` == "Medical costs"|
dat_stu_cost_sus$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_sus$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_sus$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$Susceptible_profile),]
dat_stu_cost_sus <- dat_stu_cost_sus[,-c(6:7)]
View(dat_stu_cost_sus)
View(dat_cost_res)
View(dat_stu_cost_res)
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_stu_cost_res <- dat_stu_cost_res[,-c(6:7)]
# Cost -- susceptible
dat_cost_sus <- dat[, c(68:69, 79:87)]
dat_stu_cost_sus <- cbind(dat_study, dat_cost_sus)
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$`What cost was measured?`),]
dat_stu_cost_sus <- dat_stu_cost_sus[dat_stu_cost_sus$`What cost was measured?` == "Medical costs"|
dat_stu_cost_sus$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_sus$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_sus$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$Susceptible_profile),]
dat_stu_cost_sus <- dat_stu_cost_sus[,-c(6:7)]
# Fever day data -- S. typhi & S. paratyphi / S. non-typhi
dat_stu_cost_res_r <- data.table(dat_stu_cost_res)
dat_stu_cost_sus_s <- data.table(dat_stu_cost_sus)
dat_stu_cost_res_r <- dat_stu_cost_res_r %>% rename("days" = "How many days did the symptoms last?_resistant")
dat_stu_cost_sus_s <- dat_stu_cost_sus_s %>% rename("days" = "How many days did the symptoms last?_susceptible")
dat_stu_cost_res_r[, resistance := "resistance"]
dat_stu_cost_sus_s[, resistance := "susceptible"]
dat_stu_fev <- rbind(dat_stu_cost_res_r, dat_stu_cost_sus_s, use.names=FALSE)
dat_stu_fev[resistance == "resistance", Profile := Resistance_profile]
dat_stu_fev[resistance == "susceptible", Profile := Susceptible_profile]
# Fever day data -- S. typhi & S. paratyphi / S. non-typhi
dat_stu_cost_res_r <- data.table(dat_stu_cost_res)
dat_stu_cost_sus_s <- data.table(dat_stu_cost_sus)
dat_stu_cost_res_r <- dat_stu_cost_res_r %>% rename("days" = "How many days did the symptoms last?_resistant")
dat_stu_cost_res_r <- dat_stu_cost_res_r %>% rename("days" = "What was the per-patient cost of treating a patient infected with a drug resistant pathogen?")
# Fever day data -- S. typhi & S. paratyphi / S. non-typhi
dat_stu_cost_res_r <- data.table(dat_stu_cost_res)
dat_stu_cost_sus_s <- data.table(dat_stu_cost_sus)
dat_stu_cost_res_r <- dat_stu_cost_res_r %>% rename("days" = "What was the per-patient cost of treating a patient infected with a drug resistant pathogen?")
dat_stu_cost_sus_s <- dat_stu_cost_sus_s %>% rename("days" = "What was the per-patient cost of treating a patient infected with a drug-susceptible pathogen or with a pathogen where resistance was not measured?")
dat_stu_cost_res_r[, resistance := "resistance"]
dat_stu_cost_sus_s[, resistance := "susceptible"]
dat_stu_fev <- rbind(dat_stu_cost_res_r, dat_stu_cost_sus_s, use.names=FALSE)
dat_stu_fev[resistance == "resistance", Profile := Resistance_profile]
dat_stu_fev[resistance == "susceptible", Profile := Susceptible_profile]
View(dat_stu_fev)
# Cost -- resistance
dat_cost_res <- dat[, c(68:69, 70:78)]
dat_stu_cost_res <- cbind(dat_study, dat_cost_res)
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$`What cost was measured?`),]
dat_stu_cost_res <- dat_stu_cost_res[!is.na(dat_stu_cost_res$Resistance_profile),]
dat_stu_cost_res <- dat_stu_cost_res[,-c(6:7)]
# Cost -- susceptible
dat_cost_sus <- dat[, c(68:69, 79:87)]
dat_stu_cost_sus <- cbind(dat_study, dat_cost_sus)
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$`What cost was measured?`),]
dat_stu_cost_sus <- dat_stu_cost_sus[dat_stu_cost_sus$`What cost was measured?` == "Medical costs"|
dat_stu_cost_sus$`What cost was measured?` == "Hospital costs" |
dat_stu_cost_sus$`What cost was measured?` == "Direct medical costs" |
dat_stu_cost_sus$`What cost was measured?` == "Inpatient treatment costs",]
dat_stu_cost_sus <- dat_stu_cost_sus[!is.na(dat_stu_cost_sus$Susceptible_profile),]
dat_stu_cost_sus <- dat_stu_cost_sus[,-c(6:7)]
# Cost data -- S. typhi & S. paratyphi / S. non-typhi
dat_stu_cost_res_r <- data.table(dat_stu_cost_res)
dat_stu_cost_sus_s <- data.table(dat_stu_cost_sus)
dat_stu_cost_res_r <- dat_stu_cost_res_r %>% rename("days" = "What was the per-patient cost of treating a patient infected with a drug resistant pathogen?")
dat_stu_cost_sus_s <- dat_stu_cost_sus_s %>% rename("days" = "What was the per-patient cost of treating a patient infected with a drug-susceptible pathogen or with a pathogen where resistance was not measured?")
dat_stu_cost_res_r[, resistance := "resistance"]
dat_stu_cost_sus_s[, resistance := "susceptible"]
dat_stu_cost <- rbind(dat_stu_cost_res_r, dat_stu_cost_sus_s, use.names=FALSE)
dat_stu_cost[resistance == "resistance", Profile := Resistance_profile]
dat_stu_cost[resistance == "susceptible", Profile := Susceptible_profile]
View(dat_stu_cost)
# cost
cost     <- forest_plot(dat            = dat_stu_cost,
subgroup_input = "TRUE",
width_input    = 3500,
height_input   = 600,
xlim_low       = 1,
xlim_high      = 5000,
file_name      = "cost.png")
# create function to generate forest plot
forest_plot <- function(dat, subgroup_input, width_input, height_input, xlim_low, xlim_high, file_name){
dat <- data.table(dat)
colnames(dat)[6:14] <- c("day", "statistical_measure", "comment", "uncertainty/range",
"uncertainty/range_comment", "higher", "lower", "other", "n")
dat[dat == "NULL"] <- NA
dat$day <- as.numeric(dat$day)
dat$higher <- as.numeric(dat$higher)
dat$lower <- as.numeric(dat$lower)
dat$other <- as.numeric(dat$other)
dat$n <- as.numeric(dat$n)
# adjust variables
dat[statistical_measure == "Mean", Mean := day]
dat[statistical_measure == "Median", Median := day]
dat[`uncertainty/range` == "Interquartile range", higher_i := higher]
dat[`uncertainty/range` == "Interquartile range", lower_i := lower]
dat[`uncertainty/range` == "Range", higher_r := higher]
dat[`uncertainty/range` == "Range", lower_r := lower]
dat[`uncertainty/range` == "Standard deviation", SD := other]
# dat_meta <- dat_meta[!is.na(`uncertainty/range`), ]
# dat_meta <- dat_meta[dat_meta$Pathogen != "Salmonella non-typhi", ]
dat_meta <- dat[!(is.na(higher) & statistical_measure == "Median"), ]
dat_meta <- dat_meta %>% arrange(Pathogen, Profile)
# meta & forestplot -- Salmonella_typhi
ma.data <- metamean(n = n,
mean = Mean,
data = dat_meta,
sd = SD,
median = Median,
q1 = lower_i,
q3 = higher_i,
min = lower_r,
max = higher_r,
subgroup = resistance,
random = TRUE,
fixed = FALSE,
overall = FALSE)
png(file = paste(file_name), width = width_input, height = height_input, res = 300)
if(subgroup_input == "TRUE"){
forest(ma.data,
leftcols = c("Study", "Pathogen", "Profile", "Country"),
rightlabs = c("Mean", "95% CI"),
subgroup = TRUE,
xlim = c(xlim_low, xlim_high),
print.byvar = TRUE)}
else{
forest(ma.data,
leftcols = c("Study", "Pathogen", "Profile", "Country"),
rightlabs = c("Mean", "95% CI"),
subgroup = FALSE,
xlim = c(xlim_low, xlim_high),
print.byvar = TRUE)}
dev.off()
return(ma.data)}
# cost
cost     <- forest_plot(dat            = dat_stu_cost,
subgroup_input = "TRUE",
width_input    = 3500,
height_input   = 600,
xlim_low       = 1,
xlim_high      = 5000,
file_name      = "cost.png")
cost_res <- forest_plot(dat         = dat_stu_cost_res,
type         = "Resistance",
width_input  = 3500,
height_input = 1200,
xlim_low     = 1,
xlim_high    = 5000,
file_name    = "cost_res.png")
# cost
cost     <- forest_plot(dat            = dat_stu_cost,
subgroup_input = "TRUE",
width_input    = 3500,
height_input   = 1200,
xlim_low       = 1,
xlim_high      = 5000,
file_name      = "cost.png")
